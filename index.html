<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>å¯¿å¸æ‰“ - Typing Game (HTML)</title>
  <style>
    :root{
      --brown:#8B4513;
      --light-brown:#CD853F;
      --accent:#4169E1;
    }
    html,body{height:100%;margin:0;font-family:"Noto Sans JP","Arial",sans-serif;background: linear-gradient(to bottom, #fff8dc 0%, #ffe4b5 100%);}
    .container{max-width:960px;margin:24px auto;padding:24px;}
    .card{background:#fff;border:5px solid var(--brown);border-radius:10px;padding:28px;}
    h1{font-size:4rem;margin:0;color:var(--light-brown);text-shadow:4px 4px 0 #fff,8px 8px 0 #8B4513;letter-spacing:2px;font-weight:900}
    .muted{color:#666;font-size:0.9rem}
    .center{text-align:center}
    .btn{display:inline-block;padding:12px 24px;border-radius:8px;border:none;font-weight:700;cursor:pointer}
    .btn-green{background:#32CD32;color:#fff}
    .btn-blue{background:#4169E1;color:#fff}
    .btn-red{background:#DC143C;color:#fff}
    .space-y > * + *{margin-top:1rem}
    .course-box{padding:18px;border-radius:8px}
    .mode-box{padding:16px;border-radius:6px;border:2px solid #D3D3D3;background:#FAFAFA;margin-bottom:12px}
    /* Game area */
    .game-top{background:linear-gradient(to bottom,#FFEFD5,#FFE4B5);border-bottom:5px solid var(--brown);padding:12px}
    .belt{position:relative;height:280px;background:linear-gradient(to bottom,#87CEEB 0%, #E0F6FF 100%);overflow:hidden}
    .conveyor{position:absolute;bottom:0;left:0;right:0;height:100px;background:linear-gradient(to bottom,#8B4513 0%, #654321 50%, #3E2723 100%);border-top:5px solid #5D4037}
    .conveyor::before{content:"";position:absolute;inset:0;background-image:repeating-linear-gradient(90deg,transparent,transparent 40px, rgba(255,255,255,0.07) 40px, rgba(255,255,255,0.07) 42px)}
    .sushi{position:absolute;top:50%;transform:translateY(-50%);font-size:64px;left:100%;}
    .speech{position:absolute;top:30px;left:0;right:0;text-align:center}
    .speech .box{display:inline-block;padding:20px 40px;border-radius:15px;border:3px solid #DDD;background:rgba(255,255,255,0.95);box-shadow:0 4px 6px rgba(0,0,0,0.1)}
    .typed{font-family:monospace;font-size:2rem}
    .bottom-info{background:linear-gradient(to bottom,#F5F5F5,#E8E8E8);border-top:5px solid var(--brown);padding:12px}
    .grid{display:grid;grid-template-columns:1fr 1fr;gap:12px}
    .result-big{font-size:3rem;font-weight:800}
    .meter{width:200px;height:16px;background:#E5E5E5;border-radius:8px;overflow:hidden;border:2px solid #999}
    .meter-inner{height:100%;background:linear-gradient(to right,#FFD700,#FF6347);width:0%}
    .link{color:#4169E1;text-decoration:underline;cursor:pointer}
    .footer{margin-top:16px;text-align:center;color:#666;font-size:.9rem}
    /* small screens */
    @media(max-width:520px){
      h1{font-size:2.4rem}
      .speech .box{padding:12px 18px}
      .sushi{font-size:48px}
    }
  </style>
</head>
<body>
  <div class="container">
    <div id="app">
      <div class="center">
        <h1>å¯¿å¸æ‰“</h1>
        <p class="muted">Sushida - TypingGame</p>
      </div>

      <!-- MENU -->
      <div id="menu" class="card" style="margin-top:16px">
        <h2 class="center" style="font-size:1.6rem;color:var(--brown)">ã‚³ãƒ¼ã‚¹ã‚’é¸æŠã—ã¦ãã ã•ã„</h2>

        <div class="space-y" style="margin-top:18px;max-width:720px;margin-left:auto;margin-right:auto">
          <div class="course-box" style="border:3px solid #90EE90;background:#F0FFF0">
            <h3 style="color:#228B22;margin:0;font-size:1.2rem">ãŠæ‰‹è»½ 3,000å††ã‚³ãƒ¼ã‚¹</h3>
            <p class="muted">æ–‡å­—æ•°2ã€œ7æ–‡å­—ã€åˆ¶é™æ™‚é–“60ç§’</p>
            <button class="btn btn-green" id="start-easy">ã‚¹ã‚¿ãƒ¼ãƒˆ</button>
          </div>

          <div class="course-box" style="border:3px solid #87CEEB;background:#F0F8FF">
            <h3 style="color:#4169E1;margin:0;font-size:1.2rem">ãŠå‹§ã‚ 5,000å††ã‚³ãƒ¼ã‚¹</h3>
            <p class="muted">æ–‡å­—æ•°5ã€œ10æ–‡å­—ã€åˆ¶é™æ™‚é–“90ç§’</p>
            <button class="btn btn-blue" id="start-normal">ã‚¹ã‚¿ãƒ¼ãƒˆ</button>
          </div>

          <div class="course-box" style="border:3px solid #FFB6C1;background:#FFF0F5">
            <h3 style="color:#DC143C;margin:0;font-size:1.2rem">é«˜ç´š 10,000å††ã‚³ãƒ¼ã‚¹</h3>
            <p class="muted">æ–‡å­—æ•°9ã€œ14æ–‡å­—ä»¥ä¸Šã€åˆ¶é™æ™‚é–“120ç§’</p>
            <button class="btn btn-red" id="start-hard">ã‚¹ã‚¿ãƒ¼ãƒˆ</button>
          </div>
        </div>
      </div>

      <!-- MODE SELECT -->
      <div id="mode-select" class="card" style="display:none;margin-top:16px">
        <h2 class="center" style="font-size:1.6rem;color:var(--brown)">ãƒ¢ãƒ¼ãƒ‰ã‚’é¸æŠã—ã¦ãã ã•ã„</h2>
        <p class="center muted" id="selected-course-name" style="margin-top:6px"></p>

        <div style="max-width:720px;margin:16px auto">
          <div id="modes-container"></div>

          <div class="center" style="margin-top:12px">
            <span class="link" id="back-to-course">â† ã‚³ãƒ¼ã‚¹é¸æŠã«æˆ»ã‚‹</span>
          </div>
        </div>
      </div>

      <!-- PLAYING -->
      <div id="playing" class="card" style="display:none;margin-top:16px;padding:0;overflow:hidden">
        <div class="game-top">
          <div style="display:flex;justify-content:space-between;align-items:center">
            <div>
              <div style="color:var(--brown);font-weight:700">ç²å¾—:</div>
              <div style="color:var(--accent);font-weight:800;font-size:1.6rem" id="score">0å††</div>
            </div>

            <div style="text-align:center">
              <div style="color:var(--brown);font-size:0.8rem">é€£æ‰“ãƒ¡ãƒ¼ã‚¿ãƒ¼</div>
              <div class="meter" style="margin:auto">
                <div class="meter-inner" id="meter-inner"></div>
              </div>
              <div class="muted" id="combo">ã‚³ãƒ³ãƒœ: 0</div>
            </div>

            <div style="text-align:right">
              <div style="color:var(--brown);font-weight:700">æ®‹ã‚Š:</div>
              <div style="color:#DC143C;font-weight:800;font-size:1.6rem" id="time-left">0ç§’</div>
            </div>
          </div>
        </div>

        <div class="belt" id="belt">
          <div class="speech">
            <div class="box">
              <div class="typed" id="japanese-word" style="font-size:2.5rem;font-weight:800;color:#333">---</div>
              <div style="font-family:monospace;font-size:1.6rem;margin-top:8px">
                <span style="color:var(--accent);font-weight:800" id="typed-text"></span><span id="remaining-romaji" style="color:#CCC"></span>
              </div>
            </div>
          </div>

          <div class="conveyor">
            <div id="sushi" class="sushi">ğŸ£</div>
          </div>
        </div>

        <div class="bottom-info">
          <div style="display:flex;justify-content:space-between;align-items:center">
            <div>æ­£è§£: <strong id="correct-count" style="color:#228B22">0çš¿</strong></div>
            <div>ãƒŸã‚¹: <strong id="miss-count" style="color:#DC143C">0å›</strong></div>
            <div>å˜ä¾¡: <strong id="unit-price">0å††</strong></div>
            <div id="mode-name" class="muted">-</div>
          </div>
        </div>
      </div>

      <!-- RESULT -->
      <div id="result" class="card" style="display:none;margin-top:16px">
        <h2 class="center" style="font-size:2rem;color:var(--brown)">çµæœç™ºè¡¨</h2>
        <p class="center muted" id="result-sub"></p>

        <div style="max-width:720px;margin:20px auto" id="result-body">
          <div style="border:3px solid #87CEEB;background:#F0F8FF;border-radius:10px;padding:18px;margin-bottom:12px;text-align:center">
            <div class="muted">ç²å¾—é‡‘é¡</div>
            <div class="result-big" id="result-score" style="color:var(--accent)">0å††</div>
          </div>

          <div style="border:3px solid #FFB347;background:#FFF8DC;border-radius:10px;padding:18px;margin-bottom:12px;text-align:center">
            <div class="muted">ãŠä¼šè¨ˆ</div>
            <div class="result-big" id="result-cost" style="color:#FF8C00">0å††</div>
          </div>

          <div id="profit-box" style="border-radius:10px;padding:24px;margin-bottom:12px;text-align:center"></div>

          <div class="grid">
            <div style="border:2px solid #DDD;background:#FAFAFA;border-radius:8px;padding:16px;text-align:center">
              <div class="muted">æ­£è§£æ•°</div>
              <div style="font-size:2rem;color:#228B22;font-weight:800" id="result-correct">0çš¿</div>
            </div>
            <div style="border:2px solid #DDD;background:#FAFAFA;border-radius:8px;padding:16px;text-align:center">
              <div class="muted">ãƒŸã‚¹æ•°</div>
              <div style="font-size:2rem;color:#DC143C;font-weight:800" id="result-miss">0å›</div>
            </div>
          </div>
        </div>

        <div class="center" style="margin-top:12px">
          <button class="btn" id="back-to-menu" style="background:var(--light-brown);color:#fff;padding:14px 28px;border-radius:10px">ã‚¿ã‚¤ãƒˆãƒ«ã¸æˆ»ã‚‹</button>
        </div>
      </div>

      <div class="footer">
        <p>â€»ã‚­ãƒ¼ãƒœãƒ¼ãƒ‰ã§æ–‡å­—ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„</p>
      </div>
    </div>
  </div>

  <script>
    // --- ãƒ‡ãƒ¼ã‚¿ ---
    const words = {
      easy: [
        { japanese: 'ã¾ãã‚', romaji: 'maguro', price: 120 },
        { japanese: 'ã•ã‘', romaji: 'sake', price: 100 },
        { japanese: 'ãŸã¾ã”', romaji: 'tamago', price: 140 },
        { japanese: 'ã„ã‹', romaji: 'ika', price: 100 },
        { japanese: 'ãˆã³', romaji: 'ebi', price: 100 },
        { japanese: 'ã†ã«', romaji: 'uni', price: 150 },
        { japanese: 'ã„ãã‚‰', romaji: 'ikura', price: 120 },
        { japanese: 'ã‚ã˜', romaji: 'aji', price: 100 },
        { japanese: 'ã•ã°', romaji: 'saba', price: 100 },
        { japanese: 'ãŸã“', romaji: 'tako', price: 100 }
      ],
      normal: [
        { japanese: 'ãŠã„ã—ã„', romaji: 'oishii', price: 280 },
        { japanese: 'ã‚ã‚ŠãŒã¨ã†', romaji: 'arigatou', price: 320 },
        { japanese: 'ã—ã‚“ã›ã‚“', romaji: 'shinsen', price: 280 },
        { japanese: 'ã™ã—ã‚„', romaji: 'sushiya', price: 260 },
        { japanese: 'ã‹ã„ã¦ã‚“', romaji: 'kaiten', price: 280 },
        { japanese: 'ãŠã¡ã‚ƒ', romaji: 'ocha', price: 200 },
        { japanese: 'ã‚ã•ã³', romaji: 'wasabi', price: 240 },
        { japanese: 'ã—ã‚‡ã†ãŒ', romaji: 'shouga', price: 280 },
        { japanese: 'ãŠã¦ãµã', romaji: 'otefuki', price: 280 },
        { japanese: 'ã»ãŸã¦ãŒã„', romaji: 'hotategai', price: 360 }
      ],
      hard: [
        { japanese: 'ãŠãŠã¨ã‚', romaji: 'ootoro', price: 480 },
        { japanese: 'ã—ã‚ƒã‚ŠãŒãŠã„ã—ã„', romaji: 'sharigaoishii', price: 640 },
        { japanese: 'ã‹ã„ã¦ã‚“ãšã—', romaji: 'kaitenzushi', price: 560 },
        { japanese: 'ã‚ã¶ã‚Šã‚µãƒ¼ãƒ¢ãƒ³', romaji: 'aburisaamon', price: 600 },
        { japanese: 'ã„ãã‚‰ãã‚“ã‹ã‚“', romaji: 'ikuragunkan', price: 600 },
        { japanese: 'ã¡ã‚…ã†ã¨ã‚', romaji: 'chuutoro', price: 520 },
        { japanese: 'ãˆã‚“ãŒã‚', romaji: 'engawa', price: 480 },
        { japanese: 'ã‹ã‚“ã±ã¡', romaji: 'kanpachi', price: 480 },
        { japanese: 'ã¶ã‚Šã¨ã‚', romaji: 'buritoro', price: 480 },
        { japanese: 'ã»ãŸã¦ã®ã«ãã‚Š', romaji: 'hotatenonigiri', price: 680 }
      ]
    };

    const courseSettings = {
      easy: { name: 'ãŠæ‰‹è»½3,000å††ã‚³ãƒ¼ã‚¹', time: 60, cost: 3000 },
      normal: { name: 'ãŠå‹§ã‚5,000å††ã‚³ãƒ¼ã‚¹', time: 90, cost: 5000 },
      hard: { name: 'é«˜ç´š10,000å††ã‚³ãƒ¼ã‚¹', time: 120, cost: 10000 }
    };

    const modeSettings = {
      practice: { name: 'ç·´ç¿’', speed: 0.5, description: 'æ™®é€šã‚ˆã‚Šã‚¹ãƒ”ãƒ¼ãƒ‰ãŒé…ã„ã€‚åˆ¶é™æ™‚é–“ãŒ0ã«ãªã£ãŸã‚‰çµ‚äº†ã€‚' },
      normal: { name: 'æ™®é€š', speed: 0.8, description: 'æ™®é€šã®ã‚¹ãƒ”ãƒ¼ãƒ‰ã€‚åˆ¶é™æ™‚é–“ãŒ0ã«ãªã£ãŸã‚‰çµ‚äº†ã€‚' },
      accuracy: { name: 'æ­£ç¢ºé‡è¦–', speed: 0.8, description: 'ãƒŸã‚¹ã‚¿ã‚¤ãƒ—ã‚’ã™ã‚‹ã¨ã€ã‚¿ã‚¤ãƒ—ä¸­ã®ãŠçš¿ãŒãƒªã‚»ãƒƒãƒˆã•ã‚Œã€æ–°ã—ã„çš¿ã«ãªã‚‹ã€‚' },
      speed: { name: 'é€Ÿåº¦å¿…é ˆ', speed: 1.0, description: '1åº¦ã§ã‚‚ãŠçš¿ãŒç”»é¢å¤–ã«æµã‚Œã¦ã„ãã‹ã€åˆ¶é™æ™‚é–“ãŒ0ã«ãªã£ãŸã‚‰çµ‚äº†ã€‚' },
      oneshot: { name: 'ä¸€ç™ºå‹è² ', speed: 0.8, description: 'ãƒŸã‚¹ã‚¿ã‚¤ãƒ—ã‚’ã—ãŸã‚Šã€ãŠçš¿ãŒç”»é¢å¤–ã«æµã‚Œã¦ã„ãã¨ã€ãã®å ´ã§çµ‚äº†ã€‚' }
    };

    // --- UI refs ---
    const menuEl = document.getElementById('menu');
    const modeSelectEl = document.getElementById('mode-select');
    const playingEl = document.getElementById('playing');
    const resultEl = document.getElementById('result');

    const selectedCourseNameEl = document.getElementById('selected-course-name');
    const modesContainer = document.getElementById('modes-container');

    const japaneseWordEl = document.getElementById('japanese-word');
    const typedTextEl = document.getElementById('typed-text');
    const remainingRomajiEl = document.getElementById('remaining-romaji');
    const sushiEl = document.getElementById('sushi');
    const scoreEl = document.getElementById('score');
    const meterInnerEl = document.getElementById('meter-inner');
    const comboEl = document.getElementById('combo');
    const timeLeftEl = document.getElementById('time-left');
    const correctCountEl = document.getElementById('correct-count');
    const missCountEl = document.getElementById('miss-count');
    const unitPriceEl = document.getElementById('unit-price');
    const modeNameEl = document.getElementById('mode-name');

    const resultSubEl = document.getElementById('result-sub');
    const resultScoreEl = document.getElementById('result-score');
    const resultCostEl = document.getElementById('result-cost');
    const profitBoxEl = document.getElementById('profit-box');
    const resultCorrectEl = document.getElementById('result-correct');
    const resultMissEl = document.getElementById('result-miss');

    // --- State ---
    let gameState = 'menu'; // menu, playing, result
    let course = 'normal';
    let mode = 'normal';
    let currentWord = null;
    let currentRomaji = '';
    let typedText = '';
    let score = 0;
    let timeLeft = 90;
    let correctCount = 0;
    let missCount = 0;
    let combo = 0;
    let sushiPosition = 100; // in percent (left)
    let timerInterval = null;
    let moveInterval = null;
    let keyHandler = null;

    // --- Helper UI functions ---
    function showMenu(){ menuEl.style.display='block'; modeSelectEl.style.display='none'; playingEl.style.display='none'; resultEl.style.display='none'; gameState='menu'; }
    function showModeSelect(){ menuEl.style.display='none'; modeSelectEl.style.display='block'; playingEl.style.display='none'; resultEl.style.display='none'; gameState='menu'; }
    function showPlaying(){ menuEl.style.display='none'; modeSelectEl.style.display='none'; playingEl.style.display='block'; resultEl.style.display='none'; gameState='playing'; }
    function showResult(){ menuEl.style.display='none'; modeSelectEl.style.display='none'; playingEl.style.display='none'; resultEl.style.display='block'; gameState='result'; }

    // init mode buttons
    function initModeButtons(){
      modesContainer.innerHTML = '';
      for (const key in modeSettings){
        const m = modeSettings[key];
        const div = document.createElement('div');
        div.className = 'mode-box';
        div.innerHTML = '<h3 style="margin:0;color:#333">'+m.name+'</h3><p class="muted" style="margin:6px 0 10px">'+m.description+'</p>';
        const btn = document.createElement('button');
        btn.className = 'btn';
        btn.style.background = 'var(--light-brown)';
        btn.style.color = '#fff';
        btn.style.display = 'block';
        btn.style.width = '100%';
        btn.style.padding = '10px';
        btn.textContent = 'ã‚¹ã‚¿ãƒ¼ãƒˆ';
        btn.addEventListener('mouseover', ()=> btn.style.background = 'var(--brown)');
        btn.addEventListener('mouseout', ()=> btn.style.background = 'var(--light-brown)');
        btn.addEventListener('click', ()=> { mode = key; startGame(); });
        div.appendChild(btn);
        modesContainer.appendChild(div);
      }
    }
    initModeButtons();

    // --- Game logic ---
    function pickRandomWord(){
      const list = words[course];
      return list[Math.floor(Math.random()*list.length)];
    }

    function setNewWord(w){
      currentWord = w;
      currentRomaji = w.romaji;
      typedText = '';
      sushiPosition = 100;
      updateUIWord();
      unitPriceEl.textContent = w.price + 'å††';
      sushiEl.style.left = sushiPosition + '%';
    }

    function getNewWord(){
      setNewWord(pickRandomWord());
    }

    function updateUIWord(){
      japaneseWordEl.textContent = currentWord ? currentWord.japanese : '---';
      typedTextEl.textContent = typedText;
      remainingRomajiEl.textContent = currentRomaji ? currentRomaji.slice(typedText.length) : '';
      meterInnerEl.style.width = Math.min((combo % 10) * 10, 100) + '%';
      comboEl.textContent = 'ã‚³ãƒ³ãƒœ: ' + combo;
    }

    function updateScoreUI(){
      scoreEl.textContent = score + 'å††';
    }

    function updateTimeUI(){
      timeLeftEl.textContent = timeLeft + 'ç§’';
    }

    function updateCountsUI(){
      correctCountEl.textContent = correctCount + 'çš¿';
      missCountEl.textContent = missCount + 'å›';
    }

    function clearIntervals(){
      if (timerInterval) { clearInterval(timerInterval); timerInterval = null; }
      if (moveInterval) { clearInterval(moveInterval); moveInterval = null; }
      if (keyHandler) { window.removeEventListener('keydown', keyHandler); keyHandler = null; }
    }

    function startGame(){
      // reset
      score = 0;
      timeLeft = courseSettings[course].time;
      correctCount = 0;
      missCount = 0;
      combo = 0;
      sushiPosition = 100;
      modeNameEl.textContent = modeSettings[mode].name + 'ãƒ¢ãƒ¼ãƒ‰';
      selectedCourseNameEl.textContent = courseSettings[course].name;
      updateScoreUI(); updateTimeUI(); updateCountsUI();
      getNewWord();

      // show UI
      showPlaying();

      // timer
      if (timerInterval) clearInterval(timerInterval);
      timerInterval = setInterval(()=>{
        timeLeft--;
        if (timeLeft <= 0){
          timeLeft = 0;
          updateTimeUI();
          endGame();
        } else {
          updateTimeUI();
        }
      },1000);

      // sushi movement
      if (moveInterval) clearInterval(moveInterval);
      const speed = modeSettings[mode].speed;
      moveInterval = setInterval(()=>{
        sushiPosition = sushiPosition - speed;
        sushiEl.style.left = sushiPosition + '%';
        if (sushiPosition <= -20){
          handleMissedSushi();
          sushiPosition = 100;
          sushiEl.style.left = sushiPosition + '%';
        }
      },50);

      // key handler
      if (keyHandler) window.removeEventListener('keydown', keyHandler);
      keyHandler = function(e){
        if (gameState !== 'playing') return;
        // ignore modifier keys, allow only latin letters
        if (e.key.length === 1 && /[a-z]/i.test(e.key)){
          e.preventDefault();
          const key = e.key.toLowerCase();
          const nextChar = currentRomaji[typedText.length];
          if (!nextChar) return; // safety
          if (key === nextChar){
            typedText += key;
            combo++;
            // every 10 combo give 2 seconds
            if (combo > 0 && combo % 10 === 0){
              timeLeft += 2;
              updateTimeUI();
            }
            if (typedText === currentRomaji){
              score += currentWord.price;
              correctCount++;
              updateScoreUI();
              updateCountsUI();
              getNewWord();
            } else {
              updateUIWord();
            }
          } else {
            handleMissType();
          }
        }
      };
      window.addEventListener('keydown', keyHandler);
      updateUIWord();
    }

    function handleMissType(){
      missCount++;
      combo = 0;
      updateCountsUI();
      updateUIWord();
      if (mode === 'accuracy'){
        getNewWord();
      } else if (mode === 'oneshot'){
        endGame();
      }
    }

    function handleMissedSushi(){
      missCount++;
      combo = 0;
      updateCountsUI();
      updateUIWord();
      if (mode === 'speed' || mode === 'oneshot'){
        endGame();
      } else {
        getNewWord();
      }
    }

    function endGame(){
      clearIntervals();
      // show result
      showResult();
      const courseCost = courseSettings[course].cost;
      const profit = score - courseCost;
      resultSubEl.textContent = courseSettings[course].name + ' - ' + modeSettings[mode].name + 'ãƒ¢ãƒ¼ãƒ‰';
      resultScoreEl.textContent = score + 'å††';
      resultCostEl.textContent = courseCost + 'å††';
      resultCorrectEl.textContent = correctCount + 'çš¿';
      resultMissEl.textContent = missCount + 'å›';

      profitBoxEl.style.border = '5px solid ' + (profit >= 0 ? '#90EE90' : '#FFB6C1');
      profitBoxEl.style.background = profit >= 0 ? '#F0FFF0' : '#FFF0F5';
      profitBoxEl.innerHTML = '<div class="muted">ãŠå¾—é¡</div><div style="font-size:2.4rem;font-weight:800;color:' + (profit >= 0 ? '#228B22' : '#DC143C') + '">' + (profit >= 0 ? '+' : '') + profit + 'å††</div>' + (profit >= 0 ? '<div style="margin-top:8px;font-size:1.2rem;font-weight:700;color:#228B22">ğŸ‰ å…ƒãŒå–ã‚Œã¾ã—ãŸï¼</div>' : '');
    }

    // --- Course select handlers ---
    document.getElementById('start-easy').addEventListener('click', ()=>{
      course = 'easy';
      selectedCourseNameEl.textContent = courseSettings[course].name;
      modeSelectEl.style.display = 'block';
      menuEl.style.display = 'none';
    });
    document.getElementById('start-normal').addEventListener('click', ()=>{
      course = 'normal';
      selectedCourseNameEl.textContent = courseSettings[course].name;
      modeSelectEl.style.display = 'block';
      menuEl.style.display = 'none';
    });
    document.getElementById('start-hard').addEventListener('click', ()=>{
      course = 'hard';
      selectedCourseNameEl.textContent = courseSettings[course].name;
      modeSelectEl.style.display = 'block';
      menuEl.style.display = 'none';
    });

    document.getElementById('back-to-course').addEventListener('click', ()=>{
      modeSelectEl.style.display = 'none';
      menuEl.style.display = 'block';
    });

    document.getElementById('back-to-menu').addEventListener('click', ()=>{
      clearIntervals();
      showMenu();
      resetToMenuState();
    });

    // initialize some UI values
    function resetToMenuState(){
      selectedCourseNameEl.textContent = courseSettings[course].name;
      modeNameEl.textContent = modeSettings[mode].name + 'ãƒ¢ãƒ¼ãƒ‰';
      scoreEl.textContent = '0å††';
      timeLeftEl.textContent = courseSettings[course].time + 'ç§’';
      meterInnerEl.style.width = '0%';
      comboEl.textContent = 'ã‚³ãƒ³ãƒœ: 0';
      correctCountEl.textContent = '0çš¿';
      missCountEl.textContent = '0å›';
      sushiEl.style.left = '100%';
    }
    resetToMenuState();

    // accessibility / UX
    window.addEventListener('blur', ()=>{/* optionally pause */});
    window.addEventListener('focus', ()=>{/* optionally resume */});

    // disable text selection for better experience
    document.addEventListener('selectstart', (e)=>e.preventDefault());

  </script>
</body>
</html>
